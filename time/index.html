<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>北京时间</title>

<!-- PWA 支持 -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">

<!-- Favicon: 圆角矩形钟表，中间加长指针 -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
  <rect width='64' height='64' rx='12' ry='12' fill='black' stroke='white' stroke-width='2'/>
  <line x1='32' y1='32' x2='32' y2='12' stroke='white' stroke-width='3' stroke-linecap='round'/>
  <line x1='32' y1='32' x2='52' y2='32' stroke='white' stroke-width='2' stroke-linecap='round'/>
  <circle cx='32' cy='32' r='2' fill='white'/>
</svg>">

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;width:100%;}
body{
    font-family:"Noto Sans SC",sans-serif;
    background:#000;
    color:#ccc;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
    padding:2vw;
}

.date{font-weight:300;margin-bottom:1vh;font-size:clamp(1.5rem,5vw,4rem);}
.time{font-weight:700;margin-bottom:2vh;font-size:clamp(5rem,15vw,20rem);}
.week{font-weight:400;margin-bottom:3vh;color:#bbb;font-size:clamp(1.2rem,4vw,3rem);}
.footer{position:fixed;bottom:1vh;width:100%;display:flex;justify-content:center;align-items:center;gap:0.5rem;font-size:clamp(0.8rem,3vw,1.5rem);color:#888;}
.dot{width:10px;height:10px;border-radius:50%;background:#666;transition:.3;}
</style>
</head>
<body>
<div class="date" id="date">加载中...</div>
<div class="time" id="time">--:--:--</div>
<div class="week" id="week"></div>
<div class="footer"><div class="dot" id="dot"></div><span id="src">加载中...</span></div>

<script>
const TIME_API = 'https://api.m.taobao.com/rest/api3.do?api=mtop.common.getTimestamp';
let networkOffset = 0;

const dEl=document.getElementById('date'),
      tEl=document.getElementById('time'),
      wEl=document.getElementById('week'),
      dot=document.getElementById('dot'),
      srcEl=document.getElementById('src');

const CACHE_KEY='time_cache_v1';
const CACHE_MAX_AGE=10*60*1000;

function setDot(on){ dot.style.background = on?'#0f0':'#666'; }

async function initTime() {
    // 先用缓存或本地时间
    const cache = JSON.parse(localStorage.getItem(CACHE_KEY)||'null');
    if(cache && Date.now()-cache.ts<CACHE_MAX_AGE){
        networkOffset = cache.offset;
        setDot(true);
        srcEl.textContent='时间来源：缓存/本地';
    } else {
        networkOffset = 0;
        setDot(false);
        srcEl.textContent='时间来源：本地时间';
    }

    // 请求网络时间
    try {
        const r = await fetch(TIME_API);
        const j = await r.json();
        if(j?.data?.t){
            networkOffset = parseInt(j.data.t) - Date.now();
            localStorage.setItem(CACHE_KEY, JSON.stringify({offset:networkOffset, ts:Date.now()}));
            setDot(true);
            srcEl.textContent='时间来源：网络';
        }
    } catch(e){ /* 网络失败继续用本地 */ }
}

function tick(){
    const now = Date.now() + networkOffset;
    const d = new Date(now);
    const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
    const hh=d.getHours().toString().padStart(2,'0'),
          mm=d.getMinutes().toString().padStart(2,'0'),
          ss=d.getSeconds().toString().padStart(2,'0');
    const weekday=['星期日','星期一','星期二','星期三','星期四','星期五','星期六'][d.getDay()];
    dEl.textContent=`${y}年${m}月${day}日`;
    tEl.textContent=`${hh}:${mm}:${ss}`;
    wEl.textContent=weekday;
}

// 启动
initTime().then(()=>{ tick(); setInterval(tick,1000); });
</script>
</body>
</html>
