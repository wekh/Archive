<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>北京时间</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;width:100%;}
body{
  font-family:"Noto Sans SC",sans-serif;
  background:#000;
  color:#ccc;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:2vw;
}
.date{font-weight:300;margin-bottom:1vh;font-size:clamp(1.5rem,5vw,4rem);}
.time{font-weight:700;margin-bottom:2vh;font-size:clamp(5rem,15vw,20rem);}
.week{font-weight:400;margin-bottom:3vh;color:#bbb;font-size:clamp(1.2rem,4vw,3rem);}
.footer{position:fixed;bottom:1vh;width:100%;text-align:center;color:#888;font-size:clamp(0.8rem,3vw,1.5rem);}
</style>
</head>
<body>
<div class="date" id="date">加载中...</div>
<div class="time" id="time">--:--:--</div>
<div class="week" id="week">星期--</div>
<div class="footer" id="src">时间来源：加载中</div>

<script>
const TIME_API = 'https://worldtimeapi.org/api/timezone/Asia/Shanghai';
const CACHE_KEY = 'time_cache_v1';
const CACHE_MAX_AGE = 10*60*1000; // 10分钟缓存
let networkOffset = 0;

const dEl=document.getElementById('date'),
      tEl=document.getElementById('time'),
      wEl=document.getElementById('week'),
      srcEl=document.getElementById('src');

// 更新显示
function tick(){
  const now = Date.now() + networkOffset;
  const d = new Date(now);
  const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate();
  const hh=d.getHours().toString().padStart(2,'0'),
        mm=d.getMinutes().toString().padStart(2,'0'),
        ss=d.getSeconds().toString().padStart(2,'0');
  const weekday=['日','一','二','三','四','五','六'][d.getDay()];
  dEl.textContent=`${y}年${m}月${day}日`;
  tEl.textContent=`${hh}:${mm}:${ss}`;
  wEl.textContent=`星期${weekday}`;
}

// 加载缓存
function loadCache(){
  try{
    const raw=localStorage.getItem(CACHE_KEY);
    return raw?JSON.parse(raw):null;
  }catch{return null;}
}

// 保存缓存
function saveCache(offset){
  try{
    localStorage.setItem(CACHE_KEY, JSON.stringify({offset, ts: Date.now()}));
  }catch{}
}

// 初始化时间
async function initTime(){
  const cache = loadCache();
  if(cache && Date.now()-cache.ts < CACHE_MAX_AGE){
    networkOffset = cache.offset;
    srcEl.textContent='时间来源：缓存/本地';
  } else {
    networkOffset = 0;
    srcEl.textContent='时间来源：本地';
  }

  // 请求网络时间
  try{
    const r = await fetch(TIME_API);
    const j = await r.json();
    if(j?.datetime){
      const networkTime = new Date(j.datetime).getTime();
      networkOffset = networkTime - Date.now();
      saveCache(networkOffset);
      srcEl.textContent='时间来源：网络';
    }
  }catch{
    // 网络失败继续用缓存/本地时间
  }
}

// 启动
initTime().then(()=>{ tick(); setInterval(tick,1000); });
</script>
</body>
</html>
